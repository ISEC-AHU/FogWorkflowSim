<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--*** This is a generated file.  Do not edit.  ***-->
<link rel="stylesheet" href="skin/tigris.css" type="text/css">
<link rel="stylesheet" href="skin/mysite.css" type="text/css">
<link rel="stylesheet" href="skin/site.css" type="text/css">
<link media="print" rel="stylesheet" href="skin/print.css" type="text/css">
<title>Frequently Asked Questions</title>
</head>
<body bgcolor="white" class="composite">
<!--================= start Banner ==================-->
<div id="banner">
<table width="100%" cellpadding="8" cellspacing="0" summary="banner" border="0">
<tbody>
<tr>
<!--================= start Group Logo ==================-->
<td width="50%" align="left">
<div class="groupLogo">
<a href="https://www.apache.org"><img border="0" class="logoImage" alt="The Apache Software Foundation" src="resources/images/asf_logo.png"></a>
</div>
</td>
<!--================= end Group Logo ==================-->
<!--================= start Project Logo ==================--><td width="50%" align="right">
<div align="right" class="projectLogo">
<a href="https://donate.apache.org/"><img border="0" class="logoImage" alt="Support Apache" src="resources/images/support-asf.png" width="120" height="120" title="Your donation helps The Apache Software Foundation ensure its community-driven software remains available to billions of users at absolutely no cost."></a><a href="https://poi.apache.org/"><img border="0" class="logoImage" alt="Apache POI" src="resources/images/pb-poi.png" width="120" height="120" title="Apache POI - the Java API for Microsoft Documents"></a>
</div>
</td>
<!--================= end Project Logo ==================-->
</tr>
</tbody>
</table>
</div>
<!--================= end Banner ==================-->
<!--================= start Main ==================-->
<table width="100%" cellpadding="0" cellspacing="0" border="0" summary="nav" id="breadcrumbs">
<tbody>
<!--================= start Status ==================-->
<tr class="status">
<td>
<!--================= start BreadCrumb ==================--><a href="https://www.apache.org/">Apache</a> | <a href="https://poi.apache.org/">POI</a><a href=""></a>
<!--================= end BreadCrumb ==================--></td><td id="tabs">
<!--================= start Tabs ==================-->
<div class="tab">
<span class="selectedTab"><a class="base-selected" href="index.html">Home</a></span> | <script language="Javascript" type="text/javascript">
function printit() {  
if (window.print) {
    window.print() ;  
} else {
    var WebBrowser = '<OBJECT ID="WebBrowser1" WIDTH="0" HEIGHT="0" CLASSID="CLSID:8856F961-340A-11D0-A96B-00C04FD705A2"></OBJECT>';
document.body.insertAdjacentHTML('beforeEnd', WebBrowser);
    WebBrowser1.ExecWB(6, 2);//Use a 1 vs. a 2 for a prompting dialog box    WebBrowser1.outerHTML = "";  
}
}
</script><script language="Javascript" type="text/javascript">
var NS = (navigator.appName == "Netscape");
var VERSION = parseInt(navigator.appVersion);
if (VERSION > 3) {
    document.write('  <a title="PRINT this page OUT" href="javascript:printit()">PRINT</a>');
}
</script>
</div>
<!--================= end Tabs ==================-->
</td>
</tr>
</tbody>
</table>
<!--================= end Status ==================-->
<table id="main" width="100%" cellpadding="8" cellspacing="0" summary="" border="0">
<tbody>
<tr valign="top">
<!--================= start Menu ==================-->
<td id="leftcol">
<div id="navcolumn">
<div class="menuBar">
<div class="menu">
<span class="menuLabel">Overview</span>
        
<div class="menuItem">
<a href="index.html">Home</a>
</div>
        
<div class="menuItem">
<a href="download.html">Download</a>
</div>
        
<div class="menuItem">
<a href="overview.html">Components</a>
</div>
        
<div class="menuItem">
<a href="text-extraction.html">Text Extraction</a>
</div>
        
<div class="menuItem">
<a href="encryption.html">Encryption support</a>
</div>
        
<div class="menuItem">
<a href="casestudies.html">Case Studies</a>
</div>
        
<div class="menuItem">
<a href="related-projects.html">Related projects</a>
</div>
        
<div class="menuItem">
<a href="legal.html">Legal</a>
</div>
    
</div>
<div class="menu">
<span class="menuLabel">Help</span>
        
<div class="menuItem">
<a href="apidocs/index.html">Javadocs</a>
</div>
        
<div class="menuItem">
<span class="menuSelected">FAQ</span>
</div>
        
<div class="menuItem">
<a href="mailinglists.html">Mailing Lists</a>
</div>
        
<div class="menuItem">
<a href="https://bz.apache.org/bugzilla/buglist.cgi?product=POI">Bug Database</a>
</div>
        
<div class="menuItem">
<a href="changes.html">Changelog</a>
</div>
    
</div>
<div class="menu">
<span class="menuLabel">Getting Involved</span>
        
<div class="menuItem">
<a href="subversion.html">Subversion Repository</a>
</div>
        
<div class="menuItem">
<a href="howtobuild.html">How To Build</a>
</div>
        
<div class="menuItem">
<a href="guidelines.html">Contribution Guidelines</a>
</div>
        
<div class="menuItem">
<a href="who.html">Who We Are</a>
</div>
    
</div>
<div class="menu">
<span class="menuLabel">Component APIs</span>
        
<div class="menuItem">
<a href="spreadsheet/index.html">Excel (SS=HSSF+XSSF+SXSSF)</a>
</div>
        
<div class="menuItem">
<a href="slideshow/index.html">PowerPoint (SL=HSLF+XSLF)</a>
</div>
        
<div class="menuItem">
<a href="document/index.html">Word (WP=HWPF+XWPF)</a>
</div>
        
<div class="menuItem">
<a href="hsmf/index.html">Outlook (HSMF)</a>
</div>
        
<div class="menuItem">
<a href="diagram/index.html">Visio (HDGF+XDGF)</a>
</div>
        
<div class="menuItem">
<a href="hpbf/index.html">Publisher (HPBF)</a>
</div>
    
</div>
<div class="menu">
<span class="menuLabel">Low-level Component APIs</span>
        
<div class="menuItem">
<a href="poifs/index.html">OLE2 Filesystem (POIFS)</a>
</div>
        
<div class="menuItem">
<a href="hpsf/index.html">OLE2 Document Props (HPSF)</a>
</div>
        
<div class="menuItem">
<a href="hmef/index.html">TNEF (HMEF) for winmail.dat</a>
</div>
        
<div class="menuItem">
<a href="oxml4j/index.html">OpenXML4J (OOXML)</a>
</div>
        
<div class="menuItem">
<a href="logging.html">Logging framework</a>
</div>
    
</div>
<div class="menu">
<span class="menuLabel">Apache Wide</span>
        
<div class="menuItem">
<a href="https://www.apache.org/">Apache Software Foundation</a>
</div>
        
<div class="menuItem">
<a href="https://www.apache.org/licenses/">License</a>
</div>
        
<div class="menuItem">
<a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
</div>
        
<div class="menuItem">
<a href="https://www.apache.org/foundation/thanks.html">Thanks</a>
</div>
        
<div class="menuItem">
<a href="https://www.apache.org/security/">Security</a>
</div>
    
</div>
</div>
</div>
<form target="_blank" action="https://www.google.com/search" method="get">
<table summary="search" border="0" cellspacing="0" cellpadding="0">
<tr>
<td><img height="1" width="1" alt="" src="skin/images/spacer.gif" class="spacer"></td><td nowrap="nowrap">
                          Search Apache POI<br>
<input value="poi.apache.org" name="sitesearch" type="hidden"><input size="10" name="q" id="query" type="text"><img height="1" width="5" alt="" src="skin/images/spacer.gif" class="spacer"><input name="Search" value="GO" type="submit"></td><td><img height="1" width="1" alt="" src="skin/images/spacer.gif" class="spacer"></td>
</tr>
<tr>
<td colspan="3"><img height="7" width="1" alt="" src="skin/images/spacer.gif" class="spacer"></td>
</tr>
<tr>
<td class="bottom-left-thick"></td><td bgcolor="#a5b6c6"><img height="1" width="1" alt="" src="skin/images/spacer.gif" class="spacer"></td><td class="bottom-right-thick"></td>
</tr>
</table>
</form>
</td>
<!--================= end Menu ==================-->
<!--================= start Content ==================--><td>
<div id="bodycol">
<div class="app">
<div align="center">
<h1>Frequently Asked Questions</h1>
</div>
<div class="h3">
<a name="Questions"></a>
<div class="h3">
<h3>Questions<a title="Permanent link" class="headerlink" href="#Questions">#</a>
</h3>
</div>
<ol>
<li>
<a name="faq-N10006-menu"></a><a href="#faq-N10006">
      My code uses some new feature, compiles fine but fails when live with a "MethodNotFoundException" or "IncompatibleClassChangeError"
    </a>
</li>
<li>
<a name="faq-N10019-menu"></a><a href="#faq-N10019">
      My code uses the scratchpad, compiles fine but fails to run with a "MethodNotFoundException"
    </a>
</li>
<li>
<a name="faq-N10025-menu"></a><a href="#faq-N10025">
      I'm using the poi-ooxml-schemas jar, but my code is failing with "java.lang.NoClassDefFoundError: org/openxmlformats/schemas/*something*"
    </a>
</li>
<li>
<a name="faq-N100B6-menu"></a><a href="#faq-N100B6">
      Why is reading a simple sheet taking so long?
    </a>
</li>
<li>
<a name="faq-N100C2-menu"></a><a href="#faq-N100C2">
      What is the HSSF "eventmodel"?
    </a>
</li>
<li>
<a name="faq-N100CE-menu"></a><a href="#faq-N100CE">
      Why can't read the document I created using Star Office 5.1?
    </a>
</li>
<li>
<a name="faq-N100DA-menu"></a><a href="#faq-N100DA">
      Why am I getting an exception each time I attempt to read my spreadsheet?
    </a>
</li>
<li>
<a name="faq-N100E9-menu"></a><a href="#faq-N100E9">
      How do you tell if a spreadsheet cell contains a date?
    </a>
</li>
<li>
<a name="faq-N100F9-menu"></a><a href="#faq-N100F9">
      I'm trying to stream an XLS file from a servlet and I'm having some trouble.  What's the problem?
    </a>
</li>
<li>
<a name="faq-N10123-menu"></a><a href="#faq-N10123">
      I want to set a cell format (Data format of a cell) of a excel sheet as ###,###,###.#### or ###,###,###.0000.    Is it possible using POI ?
    </a>
</li>
<li>
<a name="faq-N10133-menu"></a><a href="#faq-N10133">
      I want to set a cell format (Data format of a cell) of a excel sheet as text.    Is it possible using POI ?
    </a>
</li>
<li>
<a name="faq-N1013F-menu"></a><a href="#faq-N1013F">
      How do I add a border around a merged cell?
    </a>
</li>
<li>
<a name="faq-N1014B-menu"></a><a href="#faq-N1014B">
      I am using styles when creating a workbook in POI, but Excel refuses to open the file, complaining about "Too Many Styles".
    </a>
</li>
<li>
<a name="faq-N10165-menu"></a><a href="#faq-N10165">
      I think POI is using too much memory! What can I do?
    </a>
</li>
<li>
<a name="faq-N10192-menu"></a><a href="#faq-N10192">
      I can't seem to find the source for the OOXML CT.. classes, where do they
      come from?
    </a>
</li>
<li>
<a name="faq-N101BA-menu"></a><a href="#faq-N101BA">
      An OLE2 ("binary") file is giving me problems, but I can't share it. How can I investigate the problem on my own?
    </a>
</li>
<li>
<a name="faq-N101D4-menu"></a><a href="#faq-N101D4">
      An OOXML ("xml") file is giving me problems, but I can't share it. How can I investigate the problem on my own?
    </a>
</li>
<li>
<a name="faq-N101E6-menu"></a><a href="#faq-N101E6">
      Why do I get a java.lang.NoClassDefFoundError: javax/xml/stream/XMLEventFactory.newFactory()
    </a>
</li>
<li>
<a name="faq-N10204-menu"></a><a href="#faq-N10204">
      Can I mix POI jars from different versions?
    </a>
</li>
<li>
<a name="faq-N10224-menu"></a><a href="#faq-N10224">
            Can I access/modify workbooks/documents/slideshows in multiple threads?
            What are the multi-threading guarantees that Apache POI makes
        </a>
</li>
<li>
<a name="faq-N1023C-menu"></a><a href="#faq-N1023C">
      What are the advantages and disadvantages of the different constructor and
      write methods?
    </a>
</li>
<li>
<a name="faq-N1029C-menu"></a><a href="#faq-N1029C">
      Can POI be used with OSGI?
    </a>
</li>
<li>
<a name="faq-N102B0-menu"></a><a href="#faq-N102B0">
            Can Apache POI be compiled/used with Java 9?
        </a>
</li>
</ol>
<a name="Answers"></a>
<div class="h3">
<h3>Answers<a title="Permanent link" class="headerlink" href="#Answers">#</a>
</h3>
</div>
<a name="faq-N10006"></a>
<div class="h4">
<h4>1. 
      My code uses some new feature, compiles fine but fails when live with a "MethodNotFoundException" or "IncompatibleClassChangeError"
    <a title="Permanent link" class="headerlink" href="#faq-N10006">#</a>
</h4>
</div>
      
<p>You almost certainly have an older version of Apache POI 
	on your classpath. Quite a few runtimes and other packages 
	will ship older version of Apache POI, so this is an easy problem
	to hit without your realising. Some will ship just one old jar,
   some may ship a full set of old POI jars.</p>
      
<p>The best way to identify the offending earlier jar files is
	with a few lines of java. These will load a Core POI class, an
   OOXML class and a Scratchpad class, and report where they all came
   from.</p>
      
<pre class="code">
ClassLoader classloader =
   org.apache.poi.poifs.filesystem.POIFSFileSystem.class.getClassLoader();
URL res = classloader.getResource(
             "org/apache/poi/poifs/filesystem/POIFSFileSystem.class");
String path = res.getPath();
System.out.println("POI Core came from " + path);

classloader = org.apache.poi.POIXMLDocument.class.getClassLoader();
res = classloader.getResource("org/apache/poi/POIXMLDocument.class");
path = res.getPath();
System.out.println("POI OOXML came from " + path);

classloader = org.apache.poi.hslf.usermodel.HSLFSlideShow.class.getClassLoader();
res = classloader.getResource("org/apache/poi/hslf/usermodel/HSLFSlideShow.class");
path = res.getPath();
System.out.println("POI Scratchpad came from " + path);
      </pre>
    
<a name="faq-N10019"></a>
<div class="h4">
<h4>2. 
      My code uses the scratchpad, compiles fine but fails to run with a "MethodNotFoundException"
    <a title="Permanent link" class="headerlink" href="#faq-N10019">#</a>
</h4>
</div>
      
<p>You almost certainly have an older version earlier on your
	classpath. See the prior answer.</p>
    
<a name="faq-N10025"></a>
<div class="h4">
<h4>3. 
      I'm using the poi-ooxml-schemas jar, but my code is failing with "java.lang.NoClassDefFoundError: org/openxmlformats/schemas/*something*"
    <a title="Permanent link" class="headerlink" href="#faq-N10025">#</a>
</h4>
</div>
      
<p>To use the new OOXML file formats, POI requires a jar containing
       the file format XSDs, as compiled by 
       <a href="https://xmlbeans.apache.org/">XMLBeans</a>. These
       XSDs, once compiled into Java classes, live in the
       <em>org.openxmlformats.schemas</em> namespace.</p>
      
<p>There are two jar files available, as described in
       <a href="overview.html">the components overview section</a>.
       The <em>full jar of all of the schemas is ooxml-schemas-1.3.jar</em>, 
       and it is currently around 15mb. The <em>smaller poi-ooxml-schemas 
       jar</em> is only about 4mb. This latter jar file only contains the 
       typically used parts though.</p>
      
<p>Many users choose to use the smaller poi-ooxml-schemas jar to save
       space. However, the poi-ooxml-schemas jar only contains the XSDs and
       classes that are typically used, as identified by the unit tests.
       Every so often, you may try to use part of the file format which
       isn't included in the minimal poi-ooxml-schemas jar. In this case,
       you should switch to the full ooxml-schemas-1.3.jar. Longer term,
       you may also wish to submit a new unit test which uses the extra
       parts of the XSDs, so that a future poi-ooxml-schemas jar will 
       include them.</p>
      
<p>There are a number of ways to get the full ooxml-schemas-1.3.jar.
       If you are a maven user, see the 
       <a href="overview.html">the components overview section</a>
       for the artifact details to have maven download it for you.
       If you download the source release of POI, and/or checkout the
       source code from <a href="subversion.html">subversion</a>,
       then you can run the ant task "compile-ooxml-xsds" to have the
       OOXML schemas downloaded and compiled for you (This will also
       give you the XMLBeans generated source code, in case you wish to
       look at this). Finally, you can download the jar by hand from the
       <a href="http://mirrors.ibiblio.org/apache/poi/">POI
       Maven Repository</a>.</p>
      
<p>Note that historically, different versions of ooxml-schemas were
          used</p>

        
<table class="ForrestTable" cellspacing="1" cellpadding="4">
            
<tr class="b">
                
<th colspan="1" rowspan="1">Version of ooxml-schemas</th>
                <th colspan="1" rowspan="1">Version of POI</th>
                <th colspan="1" rowspan="1">Commment</th>
            
</tr>
            
<tr class="a">
                
<td colspan="1" rowspan="1">ooxml-schemas-1.0.jar</td>
                <td colspan="1" rowspan="1">POI 3.5 and 3.6</td>
                <td colspan="1" rowspan="1"></td>
            
</tr>
            
<tr class="b">
                
<td colspan="1" rowspan="1">ooxml-schemas-1.1.jar</td>
                <td colspan="1" rowspan="1">POI 3.7 to POI 3.13</td>
                <td colspan="1" rowspan="1">Generics support added, can be used with POI 3.5 and POI 3.6 as well</td>
            
</tr>
            
<tr class="a">
                
<td colspan="1" rowspan="1">ooxml-schemas-1.2.jar</td>
                <td colspan="1" rowspan="1">-</td>
                <td colspan="1" rowspan="1">Not released</td>
            
</tr>
            
<tr class="b">
                
<td colspan="1" rowspan="1">ooxml-schemas-1.3.jar</td>
                <td colspan="1" rowspan="1">POI 3.14 and newer</td>
                <td colspan="1" rowspan="1">Visio XML format support added, can be used with POI 3.7 - POI 3.13 as well</td>
            
</tr>
        
</table>
    
<a name="faq-N100B6"></a>
<div class="h4">
<h4>4. 
      Why is reading a simple sheet taking so long?
    <a title="Permanent link" class="headerlink" href="#faq-N100B6">#</a>
</h4>
</div>
      
<p>You've probably enabled logging.  Logging is intended only for
        autopsy style debugging.  Having it enabled will reduce performance
        by a factor of at least 100.  Logging is helpful for understanding
        why POI can't read some file or developing POI itself.  Important
        errors are thrown as exceptions, which means you probably don't need
        logging.</p>
    
<a name="faq-N100C2"></a>
<div class="h4">
<h4>5. 
      What is the HSSF "eventmodel"?
    <a title="Permanent link" class="headerlink" href="#faq-N100C2">#</a>
</h4>
</div>
      
<p>The SS eventmodel package is an API for reading Excel files without loading the whole spreadsheet into memory.  It does
        require more knowledge on the part of the user, but reduces memory consumption by more than
        tenfold.  It is based on the AWT event model in combination with SAX.  If you need read-only
        access, this is the best way to do it.</p>
    
<a name="faq-N100CE"></a>
<div class="h4">
<h4>6. 
      Why can't read the document I created using Star Office 5.1?
    <a title="Permanent link" class="headerlink" href="#faq-N100CE">#</a>
</h4>
</div>
      
<p>Star Office 5.1 writes some records using the older BIFF standard.  This causes some problems
        with POI which supports only BIFF8.</p>
    
<a name="faq-N100DA"></a>
<div class="h4">
<h4>7. 
      Why am I getting an exception each time I attempt to read my spreadsheet?
    <a title="Permanent link" class="headerlink" href="#faq-N100DA">#</a>
</h4>
</div>
      
<p>It's possible your spreadsheet contains a feature that is not currently supported by POI.
        If you encounter this then please create the simplest file that demonstrates the trouble and submit it to
	<a href="https://issues.apache.org/bugzilla/buglist.cgi?product=POI">Bugzilla.</a>
</p>
    
<a name="faq-N100E9"></a>
<div class="h4">
<h4>8. 
      How do you tell if a spreadsheet cell contains a date?
    <a title="Permanent link" class="headerlink" href="#faq-N100E9">#</a>
</h4>
</div>
      
<p>Excel stores dates as numbers therefore the only way to determine if a cell is
        actually stored as a date is to look at the formatting. There is a helper method
        in HSSFDateUtil that checks for this.
        Thanks to Jason Hoffman for providing the solution.</p>
      
<pre class="code">
   case HSSFCell.CELL_TYPE_NUMERIC:
         double d = cell.getNumericCellValue();
         // test if a date!
         if (HSSFDateUtil.isCellDateFormatted(cell)) {
           // format in form of M/D/YY
           cal.setTime(HSSFDateUtil.getJavaDate(d));
           cellText =
             (String.valueOf(cal.get(Calendar.YEAR))).substring(2);
           cellText = cal.get(Calendar.MONTH)+1 + "/" +
                      cal.get(Calendar.DAY_OF_MONTH) + "/" +
                      cellText;
         }
      </pre>
    
<a name="faq-N100F9"></a>
<div class="h4">
<h4>9. 
      I'm trying to stream an XLS file from a servlet and I'm having some trouble.  What's the problem?
    <a title="Permanent link" class="headerlink" href="#faq-N100F9">#</a>
</h4>
</div>
      
<p>
        The problem usually manifests itself as the junk characters being shown on
        screen. The problem persists even though you have set the correct mime type.
      </p>
      
<p>
        The short answer is, don't depend on IE to display a binary file type properly if you stream it via a
        servlet. Every minor version of IE has different bugs on this issue.
      </p>
      
<p>
        The problem in most versions of IE is that it does not use the mime type on
        the HTTP response to determine the file type; rather it uses the file extension
        on the request. Thus you might want to add a
        <strong>.xls</strong> to your request
        string. For example
        <em>http://yourserver.com/myServelet.xls?param1=xx</em>. This is
        easily accomplished through URL mapping in any servlet container. Sometimes
        a request like
        <em>http://yourserver.com/myServelet?param1=xx&amp;dummy=file.xls</em> is also
        known to work.
      </p>
      
<p>
        To guarantee opening the file properly in Excel from IE, write out your file to a
        temporary file under your web root from your servlet. Then send an http response
        to the browser to do a client side redirection to your temp file. (Note that using a 
        server side redirect using RequestDispatcher will not be effective in this case)
      </p>
      
<p>
        Note also that when you request a document that is opened with an
        external handler, IE sometimes makes two requests to the webserver. So if your
        generating process is heavy, it makes sense to write out to a temporary file, so that multiple
        requests happen for a static file.
      </p>
      
<p>
        None of this is particular to Excel. The same problem arises when you try to
        generate any binary file dynamically to an IE client. For example, if you generate
        pdf files using
        <a href="https://xml.apache.org/fop">FOP</a>, you will come across many of the same issues.
      </p>
      
    
<a name="faq-N10123"></a>
<div class="h4">
<h4>10. 
      I want to set a cell format (Data format of a cell) of a excel sheet as ###,###,###.#### or ###,###,###.0000.    Is it possible using POI ?
    <a title="Permanent link" class="headerlink" href="#faq-N10123">#</a>
</h4>
</div>
      
<p>
	Yes.  You first need to get a DataFormat object from the workbook and call getFormat with the desired format.  Some examples are <a href="spreadsheet/quick-guide.html#DataFormats">here</a>.
      </p>
    
<a name="faq-N10133"></a>
<div class="h4">
<h4>11. 
      I want to set a cell format (Data format of a cell) of a excel sheet as text.    Is it possible using POI ?
    <a title="Permanent link" class="headerlink" href="#faq-N10133">#</a>
</h4>
</div>
      
<p>
	Yes.  This is a built-in format for excel that you can get from DataFormat object using the format string "@".  Also, the string "text" will alias this format.
      </p>
    
<a name="faq-N1013F"></a>
<div class="h4">
<h4>12. 
      How do I add a border around a merged cell?
    <a title="Permanent link" class="headerlink" href="#faq-N1013F">#</a>
</h4>
</div>
      
<p>Add blank cells around where the cells normally would have been and set the borders individually for each cell.
        We will probably enhance HSSF in the future to make this process easier.</p>
    
<a name="faq-N1014B"></a>
<div class="h4">
<h4>13. 
      I am using styles when creating a workbook in POI, but Excel refuses to open the file, complaining about "Too Many Styles".
    <a title="Permanent link" class="headerlink" href="#faq-N1014B">#</a>
</h4>
</div>
      
<p>You just create the styles OUTSIDE of the loop in which you create cells.</p>
      
<p>GOOD:</p>
      
<pre class="code">
 HSSFWorkbook wb = new HSSFWorkbook();
 HSSFSheet sheet = wb.createSheet("new sheet");
 HSSFRow row = null;

 // Aqua background
 HSSFCellStyle style = wb.createCellStyle();
 style.setFillBackgroundColor(HSSFColor.AQUA.index);
 style.setFillPattern(HSSFCellStyle.BIG_SPOTS);
 HSSFCell cell = row.createCell((short) 1);
 cell.setCellValue("X");
 cell.setCellStyle(style);

 // Orange "foreground",
 //     foreground being the fill foreground not the font color.
 style = wb.createCellStyle();
 style.setFillForegroundColor(HSSFColor.ORANGE.index);
 style.setFillPattern(HSSFCellStyle.SOLID_FOREGROUND);

 for (int x = 0; x &lt; 1000; x++) {

 // Create a row and put some cells in it. Rows are 0 based.
	 row = sheet.createRow((short) k);

	 for (int y = 0; y &lt; 100; y++) {
		cell = row.createCell((short) k);
 		cell.setCellValue("X");
		cell.setCellStyle(style);
	 }
 }

 // Write the output to a file
 FileOutputStream fileOut = new FileOutputStream("workbook.xls");
 wb.write(fileOut);
 fileOut.close();
      </pre>
      
<p>BAD:</p>
      
<pre class="code">
 HSSFWorkbook wb = new HSSFWorkbook();
 HSSFSheet sheet = wb.createSheet("new sheet");
 HSSFRow row = null;

 for (int x = 0; x &lt; 1000; x++) {
    // Aqua background
    HSSFCellStyle style = wb.createCellStyle();
    style.setFillBackgroundColor(HSSFColor.AQUA.index);
    style.setFillPattern(HSSFCellStyle.BIG_SPOTS);
    HSSFCell cell = row.createCell((short) 1);
    cell.setCellValue("X");
    cell.setCellStyle(style);

    // Orange "foreground",
    //       foreground being the fill foreground not the font color.
    style = wb.createCellStyle();
    style.setFillForegroundColor(HSSFColor.ORANGE.index);
    style.setFillPattern(HSSFCellStyle.SOLID_FOREGROUND);

    // Create a row and put some cells in it. Rows are 0 based.
    row = sheet.createRow((short) k);

    for (int y = 0; y &lt; 100; y++) {
       cell = row.createCell((short) k);
       cell.setCellValue("X");
       cell.setCellStyle(style);
    }
 }

 // Write the output to a file
 FileOutputStream fileOut = new FileOutputStream("workbook.xls");
 wb.write(fileOut);
 fileOut.close();
      </pre>
    
<a name="faq-N10165"></a>
<div class="h4">
<h4>14. 
      I think POI is using too much memory! What can I do?
    <a title="Permanent link" class="headerlink" href="#faq-N10165">#</a>
</h4>
</div>
     
<p>This one comes up quite a lot, but often the reason isn't what
     you might initially think. So, the first thing to check is - what's
     the source of the problem? Your file? Your code? Your environment?
     Or Apache POI?</p>
     
<p>(If you're here, you probably think it's Apache POI. However, it
     often isn't! A moderate laptop, with a decent but not excessive heap
     size, from a standing start, can normally read or write a file with 
     100 columns and 100,000 rows in under a couple of seconds, including
     the time to start the JVM).</p>
     
<p>Apache POI ships with a few programs and a few example programs,
     which can be used to do some basic performance checks. For testing
     file generation, the class to use is in the examples package,
     <a href="https://svn.apache.org/repos/asf/poi/trunk/src/examples/src/org/apache/poi/ss/examples/SSPerformanceTest.java">SSPerformanceTest</a>
     (<a href="https://svn.apache.org/viewvc/poi/trunk/src/examples/src/org/apache/poi/ss/examples/SSPerformanceTest.java">viewvc</a>).
     Run SSPerformanceTest with arguments of the writing type (HSSF, XSSF
     or SXSSF), the number rows, the number of columns, and if the file
     should be saved. If you can't run that with 50,000 rows and 50 columns
     in HSSF and SXSSF in under 3 seconds, and XSSF in under 10 seconds
     (and ideally all 3 in less than that!), then the problem is with 
     your environment.</p>
     
<p>Next, use the example program
     <a href="https://svn.apache.org/repos/asf/poi/trunk/src/examples/src/org/apache/poi/ss/examples/ToCSV.java">ToCSV</a>
     (<a href="https://svn.apache.org/viewvc/poi/trunk/src/examples/src/org/apache/poi/ss/examples/ToCSV.java">viewvc</a>)
     to try reading the a file in with HSSF or XSSF. Related is
     <a href="https://svn.apache.org/repos/asf/poi/trunk/src/examples/src/org/apache/poi/xssf/eventusermodel/XLSX2CSV.java">XLSX2CSV</a>
     (<a href="https://svn.apache.org/viewvc/poi/trunk/src/examples/src/org/apache/poi/xssf/eventusermodel/XLSX2CSV.java">viewvc</a>),
     which uses SAX parsing for .xlsx. Run this against both your problem file,
     and a simple one generated by SSPerformanceTest of the same size. If this is
     slow, then there could be an Apache POI problem with how the file is being
     processed (POI makes some assumptions that might not always be right on all
     files). If these tests are fast, then any performance problems are in your
     code!</p>
    
<a name="faq-N10192"></a>
<div class="h4">
<h4>15. 
      I can't seem to find the source for the OOXML CT.. classes, where do they
      come from?
    <a title="Permanent link" class="headerlink" href="#faq-N10192">#</a>
</h4>
</div>
       
<p>The OOXML support in Apache POI is built on top of the file format
         XML Schemas, as compiled into Java using 
         <a href="https://xmlbeans.apache.org/">XMLBeans</a>. Currently,
         the compilation is done with XMLBeans 2.3, for maximum compatibility
         with installations. (You can use the resulting classes on the XMLBeans
         2.3 runtime, or any later version of XMLBeans. If you are currently using
         XMLBeans 2.2 or earlier, you will unfortunately have to upgrade, but this
         isn't common any more).</p>
        
<p>All of the <em>org.openxmlformats.schemas.spreadsheetml.x2006</em> CT...
         classes are auto-generated by XMLBeans. The resulting generated Java goes
         in the <em>ooxml-schemas-src</em> jar, and the compiled version into the
         <em>ooxml-schemas</em> jar.</p>
        
<p>The full <em>ooxml-schemas</em> jar is distributed with Apache POI, 
         along with the cut-down <em>poi-ooxml-schemas</em> jar containing just
         the common parts. The source jar isn't normally distributed with POI.
         It is, however, available from Maven Central - ask your favourite Maven
         mirror for the <em>ooxml-schemas-src</em> jar. Alternately, if you download
         the POI source distribution (or checkout from SVN) and build, Ant will
         automatically download the specification XML Schema, and compile it for 
         you to generate the source and binary ooxml-schemas jars.</p>
    
<a name="faq-N101BA"></a>
<div class="h4">
<h4>16. 
      An OLE2 ("binary") file is giving me problems, but I can't share it. How can I investigate the problem on my own?
    <a title="Permanent link" class="headerlink" href="#faq-N101BA">#</a>
</h4>
</div>
      
<p>The first thing to try is running the 
        <a href="https://blogs.msdn.com/b/officeinteroperability/archive/2011/07/12/microsoft-office-binary-file-format-validator-is-now-available.aspx">Binary File Format Validator</a>
        from Microsoft against the file, which will report if the file
        complies with the specification. If your input file doesn't, then this
        may well explain why POI isn't able to process it correctly. You 
        should probably in this case speak to whoever is generating the file,
        and have them fix it there. If your POI generated file is identified
        as having an issue, and you're on the 
        <a href="howtobuild.html">latest codebase</a>, report a new
        POI bug and include the details of the validation failure.</p>
      
<p>Another thing to try, especially if the file is valid but POI isn't
        behaving as expected, are the POI Dev Tools for the component you're
        using. For example, HSSF has <em>org.apache.poi.hssf.dev.BiffViewer</em>
        which will allow you to view the file as POI does. This will often
        allow you to check that things are being read as you expect, and 
        narrow in on problem records and structures.</p>
    
<a name="faq-N101D4"></a>
<div class="h4">
<h4>17. 
      An OOXML ("xml") file is giving me problems, but I can't share it. How can I investigate the problem on my own?
    <a title="Permanent link" class="headerlink" href="#faq-N101D4">#</a>
</h4>
</div>
       
<p>There's not currently a simple validator tool as there is for the
         OLE2 based (binary) file formats, but checking the basics of a file
         is generally much easier.</p>
       
<p>Files such as .xlsx, .docx and .pptx are actually a zip file of XML
         files, with a special structure. Your first step in diagnosing the
         issues with the input or output file will likely be to unzip the
         file, and look at the XML of it. Newer versions of Office will 
         normally tell you which area of the file is problematic, so 
         narrow in on there. Looking at the XML, does it look correct?</p>
       
<p>When reporting bugs, ideally include the whole file, but if you're
         unable to then include the snippet of XML for the problem area, and
         reference the OOXML standard for what it should contain.</p>
    
<a name="faq-N101E6"></a>
<div class="h4">
<h4>18. 
      Why do I get a java.lang.NoClassDefFoundError: javax/xml/stream/XMLEventFactory.newFactory()
    <a title="Permanent link" class="headerlink" href="#faq-N101E6">#</a>
</h4>
</div>
      
<p>This error indicates that the class XMLEventFactory does not provide 
       functionality which POI is depending upon. There can be a number of 
       different reasons for this:</p>
	  
<ul>
		
<li>Outdated xml-apis.jar, stax-apis.jar or xercesImpl.jar:<br>
        These libraries were required with Java 5 and lower, but are not actually
        required with spec-compliant Java 6 implementations, so try removing those
        libraries from your classpath. If this is not possible, try upgrading to a
        newer version of those jar files.
        </li>
		
<li>Running IBM Java 6 (potentially as part of WebSphere Application Server):<br>
        IBM Java 6 does not provide all the interfaces required by the XML standards, 
        only IBM Java 7 seems to provide the correct interfaces, so try upgrading
        your JDK.
        </li>
		
<li>Sun/Oracle Java 6 with outdated patchlevel:<br>
        Some of the interfaces were only included/fixed in some of the patchlevels for
        Java 6. Try running with the latest available patchlevel or even better use 
        Java 7/8 where this functionality should be available in all cases.
        </li>
	  
</ul>
    
<a name="faq-N10204"></a>
<div class="h4">
<h4>19. 
      Can I mix POI jars from different versions?
    <a title="Permanent link" class="headerlink" href="#faq-N10204">#</a>
</h4>
</div>
      
<p>No. This is not supported.</p>
      
<p>All POI jars in use must come from the same version. A combination
        such as <em>poi-3.11.jar</em> and <em>poi-ooxml-3.9.jar</em> is not
        supported, and will fail to work in unpredictable ways.</p>
      
<p>If you're not sure which POI jars you're using at runtime, and/or
        you suspect it might not be the one you intended, see 
        <a href="#faq-N10006">this FAQ entry</a> for details on
        diagnosing it. If you aren't sure what POI jars you need, see the
        <a href="overview.html#components">Components Overview</a>
        for details</p>
    
<a name="faq-N10224"></a>
<div class="h4">
<h4>20. 
            Can I access/modify workbooks/documents/slideshows in multiple threads?
            What are the multi-threading guarantees that Apache POI makes
        <a title="Permanent link" class="headerlink" href="#faq-N10224">#</a>
</h4>
</div>
            
<p>In short: <em>Handling different document-objects in different threads will
                work. Accessing the same document in multiple threads will not work.</em>
</p>
            
<p>This means the workbook/document/slideshow objects are not checked for
                thread safety, but any globally held object like global caches or other
                data structures are guarded against multi threaded access accordingly.</p>
            
<p>There have been
                <a href="https://mail-archives.apache.org/mod_mbox/poi-user/201109.mbox/%3C1314859350817-4757295.post@n5.nabble.com%3E">discussions</a>
                about accessing different Workbook-sheets
                in different threads concurrently. While this may work to some degree, it may lead
                to very hard to track errors as multi-threading issues typically only
                manifest after long runtime when many threads are active and the system
                is under high load, i.e. in production use! Also it might break in future
                versions of Apache POI as we do not specifically test using the library
                this way.</p>
        
<a name="faq-N1023C"></a>
<div class="h4">
<h4>21. 
      What are the advantages and disadvantages of the different constructor and
      write methods?
    <a title="Permanent link" class="headerlink" href="#faq-N1023C">#</a>
</h4>
</div>
      
<p>Across most of the UserModel classes (
<a href="/apidocs/org/apache/poi/POIDocument.html">POIDocument</a>
and
<a href="/apidocs/org/apache/poi/POIXMLDocument.html">POIXMLDocument</a>),
       you can open the document from a read-only <em>File</em>, a read-write <em>File</em>
       or an <em>InputStream</em>. You can always write out to an <em>OutputStream</em>,
       and increasing also to a <em>File</em>.
      </p>
      
<p>Opening your document from a <em>File</em> is suggested wherever possible.
       This will always be quicker and lower memory then using an <em>InputStream</em>,
       as the latter has to buffer things in memory.</p>
      
<p>When writing, you can use an <em>OutputStream</em> to write to a new file, or
       overwrite an existing one (provided it isn't already open!). On slow links / disks,
       wrapping with a <em>BufferedOutputStream</em> is suggested. To write like this, use
<a href="/apidocs/org/apache/poi/POIDocument.html#write(java.io.OutputStream)">write(OutputStream)</a>.
      </p>
      
<p>To write to the currently open file (an in-place write / replace), you need to
       have opened your document from a <em>File</em>, not an <em>InputStream</em>. In
       addition, you need to have opened from the <em>File</em> in read-write mode, not
       read-only mode. To write to the currently open file, on formats that support it
       (not all do), use
<a href="/apidocs/org/apache/poi/POIDocument.html#write()">write()</a>.
      </p>
      
<p>You can also write out to a new <em>File</em>. This is available no matter how
       you opened the document, and will create/replace a new file. It is faster and lower
       memory than writing to an <em>OutputStream</em>. However, you can't use this to 
       replace the currently open file, only files not currently open. To write to a
       new / different file, use
<a href="/apidocs/org/apache/poi/POIDocument.html#write(java.io.File)">write(File)</a>
      
</p>
      
<p>More information is also available in the 
<a href="/spreadsheet/quick-guide.html#FileInputStream">HSSF and XSSF documentation</a>,
       which largely applies to the other formats too.
      </p>
      
<p>Note that currenly (POI 3.15 beta 3), not all of the write methods are available
       for the OOXML formats yet.
      </p>
    
<a name="faq-N1029C"></a>
<div class="h4">
<h4>22. 
      Can POI be used with OSGI?
    <a title="Permanent link" class="headerlink" href="#faq-N1029C">#</a>
</h4>
</div>
    	
<p>Starting with POI 3.16 there's a workaround for OSGIs context classloader handling,
    	 i.e. it replaces the threads current context classloader with an implementation of
    	 limited class view. This will lead to IllegalStateExceptions, as xmlbeans can't find
    	 the xml schema definitions in this reduced view. The workaround is to initialize
    	 the classloader delegate of <em>POIXMLTypeLoader</em> , which defaults to the current
    	 thread context classloader. The initialization should take place before any other
    	 OOXML related calls. The class in the example could be any class, which is
    	 part of the poi-ooxml-schema or ooxml-schema:<br>
    	 
<em> POIXMLTypeLoader.setClassLoader(CTTable.class.getClassLoader());</em>
    	
</p>
	
<a name="faq-N102B0"></a>
<div class="h4">
<h4>23. 
            Can Apache POI be compiled/used with Java 9?
        <a title="Permanent link" class="headerlink" href="#faq-N102B0">#</a>
</h4>
</div>
            
<p>We did some work to verify that compilation with Java 9 is working and
                that all unit-tests pass. So Apache POI should be ready to be used with
                current Java 9 release candidates.
            </p>
            
<p>NOTE: As Java 9 is still not finally released, there might
                still be breaking changes introduced in the final release, use with care!
            </p>
            
<p>For compiling Apache POI, you should set some additional options as follows
                to open up some modules that are needed and to unset some compiler options
                which are not supported any more.
            </p>
            
<pre class="code">
                # requires Ant &gt;= 1.9.5 due to https://bz.apache.org/bugzilla/show_bug.cgi?id=58271
                export ANT_HOME=/opt/apache/apache-ant/apache-ant-1.9.7
                export PATH=$ANT_HOME/bin:$PATH

                export ANT_OPTS="-Xmx1524m \
                    --add-modules=java.xml.bind \
                    --add-opens=java.xml/com.sun.org.apache.xerces.internal.util=ALL-UNNAMED \
                    --add-opens=java.base/java.lang=ALL-UNNAMED"

                ant  \
                -Duser.language=en \
                -Duser.country=US \
                -Dmaxpermsize=-Dthis.is.a.dummy=true \
                -Djava9addmods=--add-modules=java.xml.bind \
                -Djavadoc9addmods=--add-modules=java.xml.bind \
                -Djava9addmodsvalue=-Dsun.reflect.debugModuleAccessChecks=true \
                -Djava9addopens1=--add-opens=java.xml/com.sun.org.apache.xerces.internal.util=ALL-UNNAMED \
                -Djava9addopens2=--add-opens=java.base/java.io=ALL-UNNAMED \
                -Djava9addopens3=--add-opens=java.base/java.nio=ALL-UNNAMED \
                -Djava9addopens4=--add-opens=java.base/java.lang=ALL-UNNAMED \
                -Djava9addopens5=--add-opens=java.base/jdk.internal.ref=ALL-UNNAMED \
                -Djava.locale.providers=JRE,CLDR \
                -Dcoverage.enabled=true \
                test-all
            </pre>
        
</div>
</div>
</div>
</td>
<!--================= end Content ==================-->
</tr>
</tbody>
</table>
<!--================= end Main ==================-->
<!--================= start Footer ==================-->
<div id="footer">
<table summary="footer" cellspacing="0" cellpadding="4" width="100%" border="0">
<tbody>
<tr>
<!--================= start Copyright ==================-->
<td colspan="2">
<div align="center">
<div class="copyright">
              Copyright &copy; 2002-2017&nbsp;The Apache Software Foundation. All rights reserved.<br>
              Apache, Apache POI, and the Apache POI logo are registered trademarks or
              trademarks of The Apache Software Foundation in the U.S. and/or other countries.
            </div>
</div>
</td>
<!--================= end Copyright ==================-->
</tr>
<tr>
<td align="left">
<!--================= start Host ==================-->
<!--================= end Host ==================--></td><td align="right">
<!--================= start Credits ==================-->
<div align="right">
<div class="credit"></div>
</div>
<!--================= end Credits ==================-->
</td>
</tr>
</tbody>
</table>
</div>
<!--================= end Footer ==================-->
</body>
</html>
